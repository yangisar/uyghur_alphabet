<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Uyghur Alphabet Practice Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Refined September Garden Palette */
            --bg-deep: #2d3a30;        /* Deep Moss */
            --accent-clay: #d66853;    /* Terracotta */
            --accent-leaf: #7d9d85;    /* Muted Sage */
            --accent-wheat: #e9c46a;   /* Goldenrod */
            --text-cream: #fefae0;     /* Soft Off-white */
            --card-dark: #1f2921;
            
            --pixel-font: 'Press Start 2P', cursive;
        }

        body { 
            font-family: var(--pixel-font); 
            background: var(--bg-deep); 
            color: var(--text-cream);
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh;
            overflow-x: hidden;
            text-transform: uppercase;
        }

        /* Subtle Texture Overlay */
        body::before {
            content: " ";
            display: block;
            position: fixed;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px), 
                        linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 20px 20px;
            z-index: 100;
            pointer-events: none;
        }

        .screen { display: none; width: 100%; max-width: 600px; padding: 20px; box-sizing: border-box; flex-direction: column; }
        .active { display: flex; }

        h1 { 
            font-size: 16px; 
            text-align: center; 
            color: var(--accent-wheat); 
            text-shadow: 2px 2px var(--bg-deep), 4px 4px var(--accent-clay); 
            margin-bottom: 30px; 
            line-height: 1.5;
        }

        /* Menu Styles */
        .menu-card { 
            border: 4px solid var(--accent-leaf); 
            padding: 25px; 
            background: var(--card-dark); 
            box-shadow: 8px 8px 0px rgba(0,0,0,0.3);
        }
        .option-group { margin-bottom: 25px; }
        label { display: block; margin-bottom: 12px; font-size: 10px; color: var(--accent-leaf); letter-spacing: 1px; }
        
        select { 
            width: 100%; padding: 12px; background: #131a14; color: var(--text-cream); 
            border: 2px solid var(--accent-clay); font-family: var(--pixel-font); font-size: 10px;
            outline: none;
        }

        /* Memory Cards */
        .game-board { display: grid; grid-gap: 12px; width: 100%; margin-top: 10px; }
        .card { height: 110px; perspective: 1000px; cursor: pointer; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.5s; transform-style: preserve-3d; }
        .card.flipped .card-inner { transform: rotateY(180deg); }
        
        .card-face { 
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden; 
            display: flex; align-items: center; justify-content: center; 
            border: 3px solid var(--accent-leaf); 
            border-radius: 8px;
        }
        
        .card-front { 
            background: var(--accent-leaf); 
            background: repeating-linear-gradient(45deg, var(--accent-leaf), var(--accent-leaf) 10px, #6b8a72 10px, #6b8a72 20px); 
        }
        
        .card-back { 
            background: var(--card-dark); 
            transform: rotateY(180deg); 
            color: var(--accent-wheat); 
            font-size: 14px; /* Slightly larger Latin/Cyrillic */
            box-shadow: inset 0 0 15px rgba(0,0,0,0.5); 
        }
        
        .is-uyghur { font-family: "Microsoft Uighur", serif; font-size: 42px; text-transform: none; }

        /* Drawing Pad */
        .draw-container { 
            position: relative; width: 100%; height: 350px; background: var(--card-dark); 
            border: 4px solid var(--accent-wheat); margin: 20px 0; touch-action: none; 
            box-shadow: 0 0 20px rgba(233, 196, 106, 0.1);
        }
        .ref-box { 
            position: absolute; top: 10px; left: 10px; width: 80px; height: 80px; 
            border: 2px dashed #444; display: flex; align-items: center; justify-content: center; 
            background: rgba(255,255,255,0.03); 
        }
        .ref-text { font-family: "Microsoft Uighur", serif; font-size: 40px; color: #555; text-transform: none; }
        canvas { width: 100%; height: 100%; cursor: crosshair; }

        /* Buttons */
        .btn { 
            background: var(--accent-clay); color: var(--text-cream); border: none; padding: 18px; 
            font-family: var(--pixel-font); font-size: 12px; cursor: pointer; margin-bottom: 12px;
            box-shadow: 4px 4px 0px #8a3a2b; transition: all 0.1s;
        }
        .btn:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0px #8a3a2b; }
        
        .btn-menu { 
            background: none; color: var(--accent-leaf); border: 2px solid var(--accent-leaf); 
            font-size: 8px; padding: 8px 12px; 
        }
        .btn-menu:hover { background: var(--accent-leaf); color: var(--bg-deep); }
    </style>
</head>
<body>

    <div id="setupScreen" class="screen active">
        <h1>Uyghur Alphabet<br>Practice Game</h1>
        <div class="menu-card">
            <div class="option-group">
                <label>GAME MODE</label>
                <select id="gameMode">
                    <option value="memory">MEMORY MATCH</option>
                    <option value="draw">TRACE DRAW</option>
                </select>
            </div>
            <div class="option-group">
                <label>SCRIPT TYPE</label>
                <select id="scriptType">
                    <option value="latin">LATIN</option>
                    <option value="cyrillic">CYRILLIC</option>
                </select>
            </div>
            <div class="option-group">
                <label>CONTENT</label>
                <select id="contentType">
                    <option value="alphabet">SINGLE LETTERS</option>
                    <option value="words">LETTER COMBINATIONS</option>
                </select>
            </div>
            <button class="btn" style="width:100%" onclick="startGame()">START GAME</button>
        </div>
    </div>

    <div id="memoryScreen" class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <span id="lvlDisplay" style="font-size:10px; color: var(--accent-wheat)">LVL: 01</span>
            <button class="btn-menu" onclick="showMenu()">QUIT</button>
        </div>
        <div id="gameBoard" class="game-board" style="margin-top:20px"></div>
    </div>

    <div id="drawScreen" class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 id="drawTarget" style="font-size:16px; color:var(--accent-wheat); margin:0;">A</h2>
            <button class="btn-menu" onclick="showMenu()">QUIT</button>
        </div>
        <div class="draw-container">
            <div class="ref-box"><div id="ghostText" class="ref-text">ئا</div></div>
            <canvas id="drawCanvas"></canvas>
        </div>
        <button class="btn" style="width:100%" onclick="nextDrawing()">NEXT</button>
        <button class="btn" style="width:100%; background:#4a5a4d; box-shadow:4px 4px 0 #2d3a30" onclick="clearCanvas()">RESET</button>
    </div>

    <script>
        const alphabet = [
            { latin: "A", cyrillic: "А", uyghur: "ئا" }, { latin: "E", cyrillic: "Ә", uyghur: "ئە" },
            { latin: "B", cyrillic: "Б", uyghur: "ب" }, { latin: "P", cyrillic: "П", uyghur: "پ" },
            { latin: "T", cyrillic: "Т", uyghur: "ت" }, { latin: "J", cyrillic: "Җ", uyghur: "ج" },
            { latin: "Ch", cyrillic: "Ч", uyghur: "چ" }, { latin: "X", cyrillic: "Х", uyghur: "خ" },
            { latin: "D", cyrillic: "Д", uyghur: "د" }, { latin: "R", cyrillic: "Р", uyghur: "ر" },
            { latin: "Z", cyrillic: "З", uyghur: "ز" }, { latin: "S", cyrillic: "С", uyghur: "س" },
            { latin: "Sh", cyrillic: "Ш", uyghur: "ش" }, { latin: "Gh", cyrillic: "Ғ", uyghur: "غ" },
            { latin: "Q", cyrillic: "Қ", uyghur: "ق" }, { latin: "K", cyrillic: "К", uyghur: "ك" },
            { latin: "G", cyrillic: "Г", uyghur: "گ" }, { latin: "L", cyrillic: "Л", uyghur: "ل" },
            { latin: "M", cyrillic: "М", uyghur: "م" }, { latin: "N", cyrillic: "Н", uyghur: "ن" },
            { latin: "O", cyrillic: "О", uyghur: "ئو" }, { latin: "U", cyrillic: "У", uyghur: "ئۇ" },
            { latin: "I", cyrillic: "И", uyghur: "ئى" }, { latin: "Y", cyrillic: "Й", uyghur: "ي" }
        ];

        function getCombinations() {
            let combos = [];
            const vowels = alphabet.filter(l => "AEIOU".includes(l.latin));
            const cons = alphabet.filter(l => !"AEIOU".includes(l.latin));
            for(let i=0; i<777; i++) {
                let c1 = cons[i % cons.length];
                let v = vowels[Math.floor(i / 5) % vowels.length];
                let c2 = cons[(i + 7) % cons.length];
                combos.push({
                    latin: c1.latin + v.latin.toLowerCase() + c2.latin.toLowerCase(),
                    cyrillic: c1.cyrillic + v.cyrillic.toLowerCase() + c2.cyrillic.toLowerCase(),
                    uyghur: c1.uyghur + v.uyghur.replace('ئ', '') + c2.uyghur.replace('ئ', ''),
                    id: "combo_" + i
                });
            }
            return combos;
        }
        const combinationData = getCombinations();

        let currentLevel = 1;
        const canvas = document.getElementById('drawCanvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;

        function showMenu() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('setupScreen').classList.add('active');
        }

        function startGame() {
            const mode = document.getElementById('gameMode').value;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            if(mode === 'memory') {
                document.getElementById('memoryScreen').classList.add('active');
                initMemory();
            } else {
                document.getElementById('drawScreen').classList.add('active');
                resizeCanvas();
                nextDrawing();
            }
        }

        let firstCard = null, secondCard = null, lock = false;

        function initMemory() {
            const board = document.getElementById('gameBoard');
            const isWord = document.getElementById('contentType').value === 'words';
            const data = isWord ? combinationData : alphabet;
            const script = document.getElementById('scriptType').value;
            
            board.innerHTML = '';
            const pairsCount = 3 + currentLevel;
            const selected = [...data].sort(() => 0.5 - Math.random()).slice(0, Math.min(pairsCount, 10));
            
            let deck = [];
            selected.forEach(p => {
                const matchKey = p.id || p.latin;
                deck.push({ t: p[script], m: matchKey, isUy: false });
                deck.push({ t: p.uyghur, m: matchKey, isUy: true });
            });
            deck.sort(() => 0.5 - Math.random());

            board.style.gridTemplateColumns = `repeat(${deck.length > 8 ? 4 : 3}, 1fr)`;
            deck.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.match = item.m;
                card.innerHTML = `
                    <div class="card-inner">
                        <div class="card-face card-front"></div>
                        <div class="card-face card-back ${item.isUy ? 'is-uyghur' : ''}">${item.t}</div>
                    </div>`;
                card.onclick = handleFlip;
                board.appendChild(card);
            });
            document.getElementById('lvlDisplay').textContent = `LVL: ${String(currentLevel).padStart(2, '0')}`;
        }

        function handleFlip() {
            if(lock || this === firstCard || this.classList.contains('matched')) return;
            this.classList.add('flipped');
            if(!firstCard) { firstCard = this; return; }
            secondCard = this; lock = true;

            if(firstCard.dataset.match === secondCard.dataset.match) {
                firstCard.classList.add('matched'); secondCard.classList.add('matched');
                firstCard = null; secondCard = null; lock = false;
                if(document.querySelectorAll('.matched').length === document.querySelectorAll('.card').length) {
                    setTimeout(() => { alert("LEVEL COMPLETE!"); currentLevel++; initMemory(); }, 500);
                }
            } else {
                setTimeout(() => { firstCard.classList.remove('flipped'); secondCard.classList.remove('flipped'); firstCard = null; secondCard = null; lock = false; }, 800);
            }
        }

        function resizeCanvas() { canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight; }
        function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }
        function nextDrawing() {
            const isWord = document.getElementById('contentType').value === 'words';
            const data = isWord ? combinationData : alphabet;
            const script = document.getElementById('scriptType').value;
            const item = data[Math.floor(Math.random() * data.length)];
            document.getElementById('drawTarget').textContent = item[script];
            document.getElementById('ghostText').textContent = item.uyghur;
            clearCanvas();
        }

        const getPos = (e) => {
            const r = canvas.getBoundingClientRect();
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - r.left;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - r.top;
            return { x, y };
        };

        canvas.addEventListener('mousedown', (e) => { drawing = true; const p = getPos(e); ctx.beginPath(); ctx.moveTo(p.x, p.y); });
        canvas.addEventListener('mousemove', (e) => { 
            if(!drawing) return; e.preventDefault(); const p = getPos(e); 
            ctx.lineWidth = 5; ctx.lineCap = 'round'; ctx.strokeStyle = '#e9c46a';
            ctx.lineTo(p.x, p.y); ctx.stroke();
        });
        window.addEventListener('mouseup', () => drawing = false);
        canvas.addEventListener('touchstart', (e) => { drawing = true; const p = getPos(e); ctx.beginPath(); ctx.moveTo(p.x, p.y); }, {passive: false});
        canvas.addEventListener('touchmove', (e) => { if(!drawing) return; e.preventDefault(); const p = getPos(e); ctx.lineTo(p.x, p.y); ctx.stroke(); }, {passive: false});
    </script>
</body>
</html>
