<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UYGHUR SCHOLAR: GARDEN</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            /* September Garden Palette */
            --sage-green: #81b29a;
            --terra-cotta: #e07a5f;
            --golden-hour: #f2cc8f;
            --deep-loam: #1b2618; /* Dark forest green/black */
            --soft-cream: #f4f1de;
            --muted-shadow: #3d405b;
            
            --pixel-font: 'Press Start 2P', cursive;
        }

        body { 
            font-family: var(--pixel-font); 
            background: var(--deep-loam); 
            color: var(--soft-cream);
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh;
            overflow-x: hidden;
            text-transform: uppercase;
        }

        /* --- Texture Overlay (Softened Scanlines) --- */
        body::before {
            content: " ";
            display: block;
            position: fixed;
            top: 0; left: 0; bottom: 0; right: 0;
            background: 
                linear-gradient(rgba(244, 241, 222, 0.03) 50%, rgba(0, 0, 0, 0.05) 50%),
                linear-gradient(90deg, rgba(129, 178, 154, 0.03), rgba(224, 122, 95, 0.02));
            z-index: 100;
            background-size: 100% 3px, 3px 100%;
            pointer-events: none;
        }

        .screen { display: none; width: 100%; max-width: 600px; padding: 20px; box-sizing: border-box; flex-direction: column; }
        .active { display: flex; }

        h1 { 
            font-size: 18px; 
            text-align: center; 
            color: var(--terra-cotta); 
            text-shadow: 3px 3px var(--muted-shadow); 
            margin-bottom: 30px; 
            letter-spacing: 2px;
        }

        /* Menu Styles */
        .menu-card { 
            border: 4px solid var(--sage-green); 
            padding: 20px; 
            background: rgba(27, 38, 24, 0.9); 
            box-shadow: 6px 6px 0px rgba(129, 178, 154, 0.2); 
            border-radius: 4px;
        }
        .option-group { margin-bottom: 25px; }
        
        label { 
            display: block; 
            margin-bottom: 10px; 
            font-size: 10px; 
            color: var(--sage-green); 
        }
        
        select { 
            width: 100%; padding: 10px; 
            background: #2f3e30; 
            color: var(--golden-hour); 
            border: 2px solid var(--golden-hour); 
            font-family: var(--pixel-font); 
            font-size: 10px;
            outline: none;
        }

        /* Memory Cards */
        .game-board { display: grid; grid-gap: 12px; width: 100%; margin-top: 10px; }
        .card { height: 90px; perspective: 1000px; cursor: pointer; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.4s; transform-style: preserve-3d; }
        .card.flipped .card-inner { transform: rotateY(180deg); }
        
        .card-face { 
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden; 
            display: flex; align-items: center; justify-content: center; 
            border: 3px solid var(--sage-green); 
            font-size: 10px; text-align: center;
            border-radius: 4px;
        }
        
        /* Card Back Pattern - Leafy/Garden Grid */
        .card-front { 
            background: repeating-linear-gradient(
                45deg, 
                #2f3e30, 
                #2f3e30 10px, 
                #3a4a3b 10px, 
                #3a4a3b 20px
            ); 
        }
        
        .card-back { 
            background: #253326; 
            transform: rotateY(180deg); 
            color: var(--golden-hour); 
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5); 
        }
        
        .is-uyghur { font-family: "Microsoft Uighur", serif; font-size: 32px; text-transform: none; }

        /* Drawing Pad */
        .draw-container { 
            position: relative; width: 100%; height: 350px; 
            background: #253326; 
            border: 4px solid var(--golden-hour); 
            margin: 20px 0; touch-action: none; 
            box-shadow: 4px 4px 0px rgba(242, 204, 143, 0.2); 
        }
        
        .ref-box { 
            position: absolute; top: 10px; left: 10px; width: 70px; height: 70px; 
            border: 2px dashed var(--sage-green); 
            display: flex; align-items: center; justify-content: center; 
            background: rgba(255,255,255,0.03); 
        }
        .ref-text { font-family: "Microsoft Uighur", serif; font-size: 35px; color: var(--sage-green); opacity: 0.6; text-transform: none; }
        canvas { width: 100%; height: 100%; cursor: crosshair; }

        /* Global Buttons */
        .btn { 
            background: var(--terra-cotta); 
            color: var(--deep-loam); 
            border: none; padding: 15px; 
            font-family: var(--pixel-font); font-size: 12px; cursor: pointer; margin-bottom: 10px;
            box-shadow: 4px 4px 0px var(--muted-shadow);
            border-radius: 2px;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .btn:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--muted-shadow); }
        
        .btn-menu { 
            background: none; 
            color: var(--sage-green); 
            border: 2px solid var(--sage-green); 
            font-size: 8px; padding: 5px 10px; 
            border-radius: 2px;
        }
        .btn-menu:hover { background: var(--sage-green); color: var(--deep-loam); }
    </style>
</head>
<body>

    <div id="setupScreen" class="screen active">
        <h1>[ GARDEN SCHOLAR ]</h1>
        <div class="menu-card">
            <div class="option-group">
                <label>SELECT MODE</label>
                <select id="gameMode">
                    <option value="memory">MEMORY MATCH</option>
                    <option value="draw">TRACE DRAW</option>
                </select>
            </div>
            <div class="option-group">
                <label>SELECT SCRIPT</label>
                <select id="scriptType">
                    <option value="latin">LATIN</option>
                    <option value="cyrillic">CYRILLIC</option>
                </select>
            </div>
            <div class="option-group">
                <label>DIFFICULTY</label>
                <select id="contentType">
                    <option value="alphabet">SINGLE LETTERS</option>
                    <option value="words">777 COMBOS</option>
                </select>
            </div>
            <button class="btn" style="width:100%" onclick="startGame()">ENTER GARDEN</button>
        </div>
    </div>

    <div id="memoryScreen" class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <span id="lvlDisplay" style="font-size:10px; color: var(--golden-hour);">LVL: 01</span>
            <button class="btn-menu" onclick="showMenu()">EXIT</button>
        </div>
        <div id="gameBoard" class="game-board" style="margin-top:20px"></div>
    </div>

    <div id="drawScreen" class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 id="drawTarget" style="font-size:16px; color:var(--golden-hour); margin:0;">A</h2>
            <button class="btn-menu" onclick="showMenu()">EXIT</button>
        </div>
        <div class="draw-container">
            <div class="ref-box"><div id="ghostText" class="ref-text">ئا</div></div>
            <canvas id="drawCanvas"></canvas>
        </div>
        <button class="btn" style="width:100%" onclick="nextDrawing()">NEXT SEED</button>
        <button class="btn" style="width:100%; background: #3a4a3b; color: var(--sage-green); box-shadow:4px 4px 0 #1b2618" onclick="clearCanvas()">CLEAR SOIL</button>
    </div>

    <script>
        const alphabet = [
            { latin: "A", cyrillic: "А", uyghur: "ئا" }, { latin: "E", cyrillic: "Ә", uyghur: "ئە" },
            { latin: "B", cyrillic: "Б", uyghur: "ب" }, { latin: "P", cyrillic: "П", uyghur: "پ" },
            { latin: "T", cyrillic: "Т", uyghur: "ت" }, { latin: "J", cyrillic: "Җ", uyghur: "ج" },
            { latin: "Ch", cyrillic: "Ч", uyghur: "چ" }, { latin: "X", cyrillic: "Х", uyghur: "خ" },
            { latin: "D", cyrillic: "Д", uyghur: "د" }, { latin: "R", cyrillic: "Р", uyghur: "ر" },
            { latin: "Z", cyrillic: "З", uyghur: "ز" }, { latin: "S", cyrillic: "С", uyghur: "س" },
            { latin: "Sh", cyrillic: "Ш", uyghur: "ش" }, { latin: "Gh", cyrillic: "Ғ", uyghur: "غ" },
            { latin: "Q", cyrillic: "Қ", uyghur: "ق" }, { latin: "K", cyrillic: "К", uyghur: "ك" },
            { latin: "G", cyrillic: "Г", uyghur: "گ" }, { latin: "L", cyrillic: "Л", uyghur: "ل" },
            { latin: "M", cyrillic: "М", uyghur: "م" }, { latin: "N", cyrillic: "Н", uyghur: "ن" },
            { latin: "O", cyrillic: "О", uyghur: "ئو" }, { latin: "U", cyrillic: "У", uyghur: "ئۇ" },
            { latin: "I", cyrillic: "И", uyghur: "ئى" }, { latin: "Y", cyrillic: "Й", uyghur: "ي" }
        ];

        function getCombinations() {
            let combos = [];
            const vowels = alphabet.filter(l => "AEIOU".includes(l.latin));
            const cons = alphabet.filter(l => !"AEIOU".includes(l.latin));
            for(let i=0; i<777; i++) {
                let c1 = cons[i % cons.length];
                let v = vowels[Math.floor(i / 5) % vowels.length];
                let c2 = cons[(i + 7) % cons.length];
                combos.push({
                    latin: c1.latin + v.latin.toLowerCase() + c2.latin.toLowerCase(),
                    cyrillic: c1.cyrillic + v.cyrillic.toLowerCase() + c2.cyrillic.toLowerCase(),
                    uyghur: c1.uyghur + v.uyghur.replace('ئ', '') + c2.uyghur.replace('ئ', ''),
                    id: "combo_" + i
                });
            }
            return combos;
        }
        const combinationData = getCombinations();

        let currentLevel = 1;
        const canvas = document.getElementById('drawCanvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;

        function showMenu() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('setupScreen').classList.add('active');
        }

        function startGame() {
            const mode = document.getElementById('gameMode').value;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            if(mode === 'memory') {
                document.getElementById('memoryScreen').classList.add('active');
                initMemory();
            } else {
                document.getElementById('drawScreen').classList.add('active');
                resizeCanvas();
                nextDrawing();
            }
        }

        // --- REFINED MEMORY LOGIC ---
        let firstCard = null, secondCard = null, lock = false;

        function initMemory() {
            const board = document.getElementById('gameBoard');
            const isWord = document.getElementById('contentType').value === 'words';
            const data = isWord ? combinationData : alphabet;
            const script = document.getElementById('scriptType').value;
            
            board.innerHTML = '';
            const pairsCount = 3 + currentLevel; 
            const selected = [...data].sort(() => 0.5 - Math.random()).slice(0, Math.min(pairsCount, 10));
            
            let deck = [];
            selected.forEach(p => {
                const matchKey = p.id || p.latin;
                deck.push({ t: p[script], m: matchKey, isUy: false });
                deck.push({ t: p.uyghur, m: matchKey, isUy: true });
            });
            deck.sort(() => 0.5 - Math.random());

            board.style.gridTemplateColumns = `repeat(${deck.length > 8 ? 4 : 3}, 1fr)`;
            deck.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.match = item.m;
                card.innerHTML = `
                    <div class="card-inner">
                        <div class="card-face card-front"></div>
                        <div class="card-face card-back ${item.isUy ? 'is-uyghur' : ''}">${item.t}</div>
                    </div>`;
                card.onclick = handleFlip;
                board.appendChild(card);
            });
            document.getElementById('lvlDisplay').textContent = `LVL: ${String(currentLevel).padStart(2, '0')}`;
        }

        function handleFlip() {
            if(lock || this === firstCard || this.classList.contains('matched')) return;
            this.classList.add('flipped');
            if(!firstCard) { firstCard = this; return; }
            secondCard = this; lock = true;

            if(firstCard.dataset.match === secondCard.dataset.match) {
                firstCard.classList.add('matched'); secondCard.classList.add('matched');
                firstCard = null; secondCard = null; lock = false;
                if(document.querySelectorAll('.matched').length === document.querySelectorAll('.card').length) {
                    setTimeout(() => { alert("BLOOM!"); currentLevel++; initMemory(); }, 500);
                }
            } else {
                setTimeout(() => { firstCard.classList.remove('flipped'); secondCard.classList.remove('flipped'); firstCard = null; secondCard = null; lock = false; }, 800);
            }
        }

        // --- DRAWING LOGIC ---
        function resizeCanvas() { canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight; }
        function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }
        function nextDrawing() {
            const isWord = document.getElementById('contentType').value === 'words';
            const data = isWord ? combinationData : alphabet;
            const script = document.getElementById('scriptType').value;
            const item = data[Math.floor(Math.random() * data.length)];
            document.getElementById('drawTarget').textContent = item[script];
            document.getElementById('ghostText').textContent = item.uyghur;
            clearCanvas();
        }

        const getPos = (e) => {
            const r = canvas.getBoundingClientRect();
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - r.left;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - r.top;
            return { x, y };
        };

        canvas.addEventListener('mousedown', (e) => { drawing = true; const p = getPos(e); ctx.beginPath(); ctx.moveTo(p.x, p.y); });
        canvas.addEventListener('mousemove', (e) => { 
            if(!drawing) return; e.preventDefault(); const p = getPos(e); 
            // Changed stroke style to Golden Hour
            ctx.lineWidth = 4; ctx.lineCap = 'round'; ctx.strokeStyle = '#f2cc8f';
            ctx.shadowBlur = 5; ctx.shadowColor = '#e07a5f';
            ctx.lineTo(p.x, p.y); ctx.stroke();
        });
        window.addEventListener('mouseup', () => drawing = false);
        canvas.addEventListener('touchstart', (e) => { drawing = true; const p = getPos(e); ctx.beginPath(); ctx.moveTo(p.x, p.y); }, {passive: false});
        canvas.addEventListener('touchmove', (e) => { if(!drawing) return; e.preventDefault(); const p = getPos(e); ctx.lineTo(p.x, p.y); ctx.stroke(); }, {passive: false});
    </script>
</body>
</html>
